<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Giulia Telemetry Analyzer</title>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <script src="https://cdn.jsdelivr.net/npm/hammerjs@2.0.8"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://apis.google.com/js/api.js" async defer></script>

    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="app-container">
        <div class="sidebar" id="sidebar">
            <h2>My Giulia Telemetry Analyzer</h2>

            <div class="control-group">
                <h3 class="group-header">Log Source <span class="config-link" onclick="toggleConfig()">(Drive
                        Config)</span></h3>
                <div id="configPanel">
                    <p style="font-size:0.8em; color:#666; margin-bottom:5px;">Enter your Google Cloud <b>Client ID</b>
                        only.</p>
                    <input type="text" id="gClientId" placeholder="Your Client ID (apps.googleusercontent.com)">
                    <button class="btn" onclick="saveConfig()">Save Config</button>
                </div>
                <div class="button-row">
                    <button id="authBtn" class="btn btn-primary" onclick="handleAuth()">Drive Scan</button>
                    <button class="btn" onclick="document.getElementById('fileInput').click()">Local File</button>
                </div>
                <input type="file" id="fileInput" accept=".json" style="display:none;">
                <div id="driveList" class="drive-list"></div>
                <div id="fileInfo" class="status-text"></div>
            </div>

            <div class="control-group anomaly-box">
                <h3>Anomaly Scanner</h3>

                <div style="margin-bottom: 10px;">
                    <select id="anomalyTemplate" onchange="applyTemplate()" class="template-select">
                        <option value="">-- Load a Template --</option>
                    </select>
                </div>

                <div id="filtersContainer"></div>
                <button class="btn btn-add" onclick="addFilterRow()">+ Add Condition</button>
                <button class="btn btn-primary mt-10" onclick="scanAnomalies()">Scan Log</button>
                <div id="scanCount" class="result-count"></div>
                <div id="scanResults" class="results-list"></div>
            </div>

            <div class="control-group">
                <!--
                <h3>Timeframe</h3>
                <div class="slider-wrapper">
                    <div class="slider-track"></div>
                    <div id="sliderHighlight" class="slider-highlight"></div>
                    <input type="range" id="rangeStart" min="0" max="100" value="0" step="0.1">
                    <input type="range" id="rangeEnd" min="0" max="100" value="100" step="0.1">
                </div>
                 -->
                <div class="time-labels">
                    <span id="txtStart">0.0s</span>
                    <span id="txtEnd">0.0s</span>
                </div>
                <button class="btn mt-5" onclick="resetZoom()">Reset View</button>
            </div>

            <div class="control-group flex-grow">
                <div class="group-header-row">
                    <h3>Signals</h3>
                    <div class="button-row-sm">
                        <button class="btn btn-sm" onclick="toggleAllSignals(true)">All</button>
                        <button class="btn btn-sm" onclick="toggleAllSignals(false)">None</button>
                    </div>
                </div>
                <div id="signalList" class="signal-list"></div>
            </div>
        </div>

        <div id="resizer" class="resizer"></div>

        <div class="main-content" id="mainContent">
            <div class="toolbar">
                <button class="btn" onclick="toggleSidebar()">‚ò∞</button>
                <button class="btn" onclick="toggleFullScreen()">‚õ∂</button>
            </div>
            <div id="chartContainer">
                <canvas id="telemetryChart"></canvas>
            </div>
        </div>
    </div>


    <div id="loadingOverlay" class="loading-overlay" style="display:none;">
        <div class="spinner"></div>
        <div id="loadingText">Loading...</div>
        <button id="cancelLoadBtn" class="btn">Cancel</button>
    </div>

    <div id="infoModal" class="modal-overlay" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Application Overview</h2>
                <button class="btn-close" onclick="toggleInfo()">√ó</button>
            </div>
            <div class="modal-body">
                <p class="app-description">
                    <strong>My Giulia Telemetry Analyzer:</strong> A  tool for visualizing
                    and scanning vehicle OBD data. Compare multiple logs, sync timelines, and detect
                    mechanical anomalies automatically.
                </p>

                <div class="info-grid">
                    <div class="info-card">
                        <h4>üîç Anomaly Scanning</h4>
                        <p>Uses logic templates to pinpoint events like boost leaks with contextual zoom.</p>
                    </div>
                    <div class="info-card">
                        <h4>üîÑ Multi-Sync</h4>
                        <p>Pan or zoom on any chart to automatically align all loaded logs.</p>
                    </div>

                    <div class="info-card data-source-card">
                        <h4>üì± Data Source</h4>
                        <p>
                            Telemetry data is collected by the <strong>MyGiulia</strong> Android application.
                        </p>
                        <a href="https://play.google.com/store/apps/details?id=org.obd.graphs.my.giulia&hl=pl&pli=1"
                            target="_blank" class="play-store-link">
                            View on Google Play ‚Üí
                        </a>
                    </div>

                    <div class="info-card">
                        <h4>‚òÅÔ∏è Cloud Integration</h4>
                        <p>Securely save and load logs via Google Drive integration.</p>
                    </div>
                </div>

                <div class="technical-meta">
                    <span><strong>Version:</strong>1.0.0</span>
                    <span><strong>Engine:</strong> Chart.js + Zoom Plugin</span>
                    <span><strong>Status:</strong> All Systems Nominal</span>
                </div>
            </div>
        </div>
    </div>

    <button class="floating-info-btn" onclick="UI.toggleInfo()" title="App Info">i</button>


    <script src="config.js"></script>
    <script src="auth.js"></script>
    <script src="drive.js"></script>
    <script src="chart.js"></script>
    <script src="ui.js"></script>
    <script src="analysis.js"></script>
    <script src="core.js"></script>
</body>

</html>