<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>My Giulia Telemetry Analyzer</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
    <link rel="stylesheet" href="./src/style.css" />
  </head>

  <body>
    <div class="app-container">
      <div class="sidebar" id="sidebar">
        <h2>My Giulia Telemetry Analyzer</h2>
        <div class="control-group gray-box">
          <h3>Settings & Preferences</h3>
          <div class="preferences-list">
            <div class="pref-item">
              <div class="pref-info">
                <span class="pref-title">Dark Mode</span>
                <span class="pref-desc">Switch to a dark visual theme</span>
              </div>
              <label class="switch">
                <input type="checkbox" id="pref-theme-dark" />
                <span class="slider-round"></span>
              </label>
            </div>

            <hr />

            <div class="pref-subgroup">
              <div class="pref-item">
                <div class="pref-info">
                  <span class="pref-title">Google Drive Integration</span>
                  <span class="pref-desc">Cloud access configuration</span>
                </div>
                <button
                  class="btn btn-sm btn-add"
                  id="toggle-drive-config"
                  onclick="toggleDriveConfig()"
                >
                  <i class="fas fa-cog"></i> Config
                </button>
              </div>

              <div
                id="configPanel"
                style="
                  display: none;
                  margin-top: 10px;
                  padding: 10px;
                  background: #f0f0f0;
                  border-radius: 4px;
                "
              >
                <input
                  type="text"
                  id="gClientId"
                  placeholder="Enter Google Client ID"
                  style="margin-bottom: 8px"
                />
                <button
                  class="btn btn-primary btn-sm"
                  onclick="saveDriveConfig()"
                >
                  Save ID
                </button>
              </div>
            </div>

            <hr />

            <div class="pref-item">
              <div class="pref-info">
                <span class="pref-title">Remember Layout</span>
                <span class="pref-desc">Persist collapsed sections</span>
              </div>
              <label class="switch">
                <input type="checkbox" id="pref-persistence" checked />
                <span class="slider-round"></span>
              </label>
            </div>

            <div class="pref-item">
              <div class="pref-info">
                <span class="pref-title">High Performance</span>
                <span class="pref-desc">Reduce chart rendering overhead</span>
              </div>
              <label class="switch">
                <input type="checkbox" id="pref-performance" />
                <span class="slider-round"></span>
              </label>
            </div>
          </div>
        </div>

        <div class="control-group gray-box">
          <h3 class="group-header">Log Source</h3>
          <div class="button-row">
            <button id="authBtn" class="btn btn-primary" onclick="handleAuth()">
              Drive Scan
            </button>
            <button
              class="btn"
              onclick="document.getElementById('fileInput').click()"
            >
              Local File
            </button>
          </div>
          <input
            type="file"
            id="fileInput"
            accept=".json"
            style="display: none"
          />
          <div id="driveList" class="drive-list"></div>
          <div id="fileInfo" class="status-text"></div>
        </div>

        <div class="control-group gray-box">
          <h3>Anomaly Scanner</h3>

          <div style="margin-bottom: 10px">
            <select
              id="anomalyTemplate"
              onchange="applyTemplate()"
              class="template-select"
            >
              <option value="">-- Load a Template --</option>
            </select>
          </div>

          <div id="filtersContainer"></div>
          <button class="btn btn-add" onclick="addFilterRow()">
            + Add Condition
          </button>
          <button class="btn btn-primary mt-10" onclick="scanAnomalies()">
            Scan Log
          </button>
          <div id="scanCount" class="result-count"></div>
          <div id="scanResults" class="results-list"></div>
        </div>

        <div class="control-group">
          <!--
                <h3>Timeframe</h3>
                <div class="slider-wrapper">
                    <div class="slider-track"></div>
                    <div id="sliderHighlight" class="slider-highlight"></div>
                    <input type="range" id="rangeStart" min="0" max="100" value="0" step="0.1">
                    <input type="range" id="rangeEnd" min="0" max="100" value="100" step="0.1">
                </div>
                <div class="time-labels">
                  <span id="txtStart">0.0s</span>
                  <span id="txtEnd">0.0s</span>
                </div>
           -->
          <button class="btn mt-5" onclick="resetZoom()">Reset View</button>
        </div>

        <div class="control-group flex-grow gray-box">
          <div class="group-header-row">
            <h3>Signals</h3>
            <div class="button-row-sm">
              <button class="btn btn-sm" onclick="toggleAllSignals(true)">
                All
              </button>
              <button class="btn btn-sm" onclick="toggleAllSignals(false)">
                None
              </button>
            </div>
          </div>
          <div id="signalList" class="signal-list"></div>
        </div>
      </div>

      <div id="resizer" class="resizer"></div>

      <div class="main-content" id="mainContent">
        <div class="toolbar">
          <button class="btn" onclick="toggleSidebar()">‚ò∞</button>
          <button class="btn" onclick="toggleFullScreen()">‚õ∂</button>
          <button class="btn" onclick="toggleInfo()" title="App Info">
            <i
              class="fas fa-info-circle fa-xl"
              style="color: var(--primary-red)"
            ></i>
          </button>
          <button class="btn-docs" onclick="window.location.href = 'docs.html'">
            <i class="fas fa-book"></i> My Giulia Documentation
          </button>
        </div>

        <div id="chartContainer">
          <canvas id="telemetryChart"></canvas>
        </div>

        <div id="dropZone" class="drop-zone">
          <div class="drop-zone-content">
            <i class="fas fa-file-upload"></i>
            <p>Drag & Drop telemetry JSON here or <span>browse</span></p>
            <input type="file" id="fileInputDropZone" accept=".json" hidden />
          </div>
        </div>
      </div>
    </div>

    <div id="loadingOverlay" class="loading-overlay" style="display: none">
      <div class="spinner"></div>
      <div id="loadingText">Loading...</div>
      <button id="cancelLoadBtn" class="btn">Cancel</button>
    </div>

    <div id="infoModal" class="modal-overlay" style="display: none">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Application Overview</h2>
          <button class="btn-close" onclick="toggleInfo()">√ó</button>
        </div>
        <div class="modal-body">
          <p class="app-description">
            <strong>My Giulia Telemetry Analyzer:</strong> A professional tool
            for visualizing and scanning vehicle OBD data. Compare multiple
            logs, sync timelines, and detect mechanical anomalies automatically.
          </p>

          <div class="info-grid">
            <div class="info-card data-source-card" style="grid-column: span 2">
              <h4>üì± Data Source</h4>
              <div class="data-source-flex">
                <img
                  src="https://lh3.googleusercontent.com/d_S-jY_V_7z9_x_W5y_6z5z6z5z6z5z6z5z6z5z6z5z6z5z6z5z6z5z6z5z6z5z6=s128"
                  alt="MyGiulia Logo"
                  class="app-icon"
                  onerror="
                    this.src = 'https://img.icons8.com/color/96/google-play.png'
                  "
                />
                <div class="data-source-text">
                  <p>
                    Telemetry data is collected by the
                    <strong>MyGiulia</strong> Android application.
                  </p>
                  <a
                    href="https://play.google.com/store/apps/details?id=org.obd.graphs.my.giulia"
                    target="_blank"
                    class="play-store-btn"
                  >
                    <img
                      src="https://upload.wikimedia.org/wikipedia/commons/7/78/Google_Play_Store_badge_EN.svg"
                      alt="Get it on Google Play"
                      height="30"
                    />
                  </a>
                </div>
              </div>
            </div>

            <div class="info-card" style="grid-column: span 2">
              <h4>üì• How to Import Logs</h4>
              <ol class="import-steps">
                <li>Open <strong>MyGiulia</strong> on your Android device.</li>
                <li>
                  Navigate to the <strong>Graph</strong> view and select
                  <strong>Manage recorded trips</strong>.
                </li>
                <li>Select your log and tap <strong>Send to Cloud</strong>.</li>
                <li>
                  Upload the file here using the
                  <strong>"Upload Log"</strong> button.
                </li>
              </ol>

              <div class="sample-data-box">
                <p>No log files handy? Try this real-world trip profile:</p>
                <button class="btn btn-sample" onclick="loadSampleData()">
                  üìÇ Load Sample Trip (JSON)
                </button>
              </div>
            </div>

            <div class="info-card">
              <h4>üîç Anomaly Scanning</h4>
              <p>
                Uses logic templates to pinpoint events like boost leaks with
                contextual zoom.
              </p>
            </div>
            <div class="info-card">
              <h4>üîÑ Multi-Sync</h4>
              <p>
                Pan or zoom on any chart to automatically align all loaded logs.
              </p>
            </div>
          </div>
          <div class="modal-footer">
            <div class="modal-preferences">
              <label class="custom-checkbox-container">
                <input type="checkbox" id="hideInfoCheckbox" />
                <span class="checkmark"></span>
                <span class="label-text">Don't show this again</span>
              </label>
              <button id="closeInfoBtn" class="btn btn-primary">Got it!</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <div class="footer-content">
        <small
          style="color: var(--text-muted); font-size: 0.9rem; margin-left: 10px"
          >¬© 2025 My Giulia Telemetry Analyzer</small
        >
        <a
          href="policy.html"
          style="color: var(--text-muted); font-size: 0.9rem; margin-left: 10px"
          >Privacy Policy</a
        >
        <span id="appVersion" class="app-version-container"></span>
      </div>
    </footer>

    <script type="module" src="./src/config.js"></script>
    <script type="module" src="./src/auth.js"></script>
    <script type="module" src="./src/drive.js"></script>
    <script type="module" src="./src/chartmanager.js"></script>
    <script type="module" src="./src/ui.js"></script>
    <script type="module" src="./src/analysis.js"></script>
    <script type="module" src="./src/dataprocesssor.js"></script>
    <script type="module" src="./src/entry.js"></script>
  </body>
</html>
